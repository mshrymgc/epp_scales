<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SD3</title>
  <link rel="stylesheet" href="../dist/jspsych.css" />
  <link rel="stylesheet" href="../dist/survey.min.css" />
  <style>
    /* ==========================================
       åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
       ========================================== */
    body { 
      font-family: system-ui, sans-serif; 
    }
    
    /* ã‚«ãƒ¼ãƒ‰å‹ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    .card { 
      background: #fff; 
      border: 1px solid #eee; 
      border-radius: 12px; 
      padding: 1rem; 
    }
    
    /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .grid { 
      display: grid; 
      gap: 1rem; 
    }
    
    /* ã‚°ãƒ©ãƒ•ã®ãƒ©ãƒƒãƒ‘ãƒ¼ */
    .chart-wrap { 
      position: relative; 
      width: 100%; 
      max-width: 500px; 
      height: 46vh; 
      max-height: 420px; 
      margin: 0 auto; 
    }
    
    .chart-wrap canvas { 
      display: block; 
      margin: 0 auto; 
    }
    
    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    table { 
      border-collapse: collapse; 
      width: 100%; 
    }
    
    th, td { 
      padding: 0.4rem 0.3rem; 
      border-bottom: 1px solid #eee; 
      text-align: left; 
    }
    
    /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ */
    .small { 
      font-size: 0.85rem; 
    }
    
    .muted { 
      color: #666; 
    }
    
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆãƒ›ãƒãƒ¼æ™‚ã®èª¬æ˜è¡¨ç¤ºï¼‰ */
    .likert-label-tooltip { 
      position: relative; 
    }
    
    .likert-label-tooltip::after { 
      content: attr(data-tooltip); 
      position: absolute; 
      bottom: 120%; 
      left: 50%; 
      transform: translateX(-50%); 
      background: #333; 
      color: #fff; 
      padding: 0.4rem 0.6rem; 
      border-radius: 4px; 
      white-space: nowrap; 
      font-size: 0.8rem; 
      opacity: 0; 
      transition: opacity 0.15s ease; 
      pointer-events: none; 
      z-index: 10; 
    }
    
    .likert-label-tooltip:hover::after { 
      opacity: 1; 
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="../dist/jspsych.js"></script>
  <script src="../dist/plugin-html-button-response.js"></script>
  <script src="../dist/plugin-survey.js"></script>
  <script src="../dist/plugin-survey-likert.js"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.5.0/dist/index.browser.min.js"></script>
</head>
<body>
  <div id="jspsych-target"></div>
  <script>
(function(){
  // ==========================================
  // jsPsych ã®åˆæœŸåŒ–
  // ==========================================
  const jsPsych = window.jsPsychModule.initJsPsych({ 
    display_element: 'jspsych-target', 
    show_progress_bar: true, 
    auto_update_progress_bar: false 
  });
  
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹
  window.__jsPsych = jsPsych;
  
  // ==========================================
  // é€²æ—ãƒãƒ¼ã®ãƒ©ãƒ™ãƒ«ã‚’æ—¥æœ¬èªåŒ–
  // ==========================================
  (function setProgressLabel(){
    const setLabel = () => {
      const span = document.querySelector('#jspsych-progressbar-container span');
      if (span) { 
        span.innerHTML = 'é€²æ—çŠ¶æ³'; 
        return true; 
      }
      return false;
    };
    
    if (!setLabel()) {
      const mo = new MutationObserver((_, obs) => { 
        if (setLabel()) obs.disconnect(); 
      });
      mo.observe(document.body, { childList: true, subtree: true });
    }
  })();
  
  // ==========================================
  // å°ºåº¦é …ç›®ã®å®šç¾©ï¼ˆSD3-J: ãƒ€ãƒ¼ã‚¯ãƒˆãƒ©ã‚¤ã‚¢ãƒ‰ï¼‰
  // ==========================================
  // ä¸‹å¸å¿ å¤§ãƒ»å°å¡©çœŸå¸ (2017) ã®æ—¥æœ¬èªç‰ˆShort Dark Triad
  const SD3 = {
    // ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ ï¼ˆMachiavellianismï¼‰: 9é …ç›®
    // ç›®çš„ã®ãŸã‚ã«ä»–è€…ã‚’æ“ä½œã™ã‚‹å‚¾å‘
    M: [
      "ä»–ã®èª°ã‹ã«è‡ªåˆ†ã®ç§˜å¯†ã‚’æ•™ãˆãªã„ã¨ã„ã†ã“ã¨ã¯è³¢æ˜ãªã“ã¨ã ã€‚",
      "è‡ªåˆ†ã®æ€ã„é€šã‚Šã«ãªã‚‹ã‚ˆã†ã«ï¼Œè³¢ãå‘¨ã‚Šã®äººã€…ã‚’æ‰±ã„ãŸã„ã€‚",
      "ã¨ã«ã‹ãï¼Œé‡è¦ãªäººç‰©ã¯è‡ªåˆ†ã®å‘³æ–¹ã«ä»˜ã‘ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã€‚",
      "å°†æ¥ãã®äººãŒè‡ªåˆ†ã®å½¹ã«ç«‹ã¤ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ï¼Œäººã¨ã®ç›´æ¥ã®äº‰ã„ã¯é¿ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚",
      "å¾Œã«ãªã£ã¦èª°ã‹ã«å¯¾ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ãªæƒ…å ±ã«ç›®ã‚’é…ã£ã¦ãŠãã“ã¨ã¯è³¢æ˜ãªã“ã¨ã ã€‚",
      "èª°ã‹ã«å¾©è®ã™ã‚‹ãªã‚‰ï¼Œãã‚Œã«æœ€é©ãªæ™‚ãŒæ¥ã‚‹ã¾ã§ã˜ã£ã¨å¾…ã¤ã¹ãã ã€‚",
      "è‡ªåˆ†ã®è‰¯ã„è©•åˆ¤ã‚’å®ˆã‚‹ãŸã‚ã«ï¼Œä»–ã®äººã«ç§˜å¯†ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚",
      "è‡ªåˆ†ã®è¨ˆç”»ãŒï¼Œä»–ã®èª°ã‹ã®åˆ©ç›Šã§ã¯ãªãè‡ªåˆ†ã®åˆ©ç›Šã«ãªã‚‹ã‚ˆã†ã«å–ã‚Šè¨ˆã‚‰ã£ã¦ã„ã‚‹ã€‚",
      "ã»ã¨ã‚“ã©ã®äººã€…ã¯ç°¡å˜ã«é¨™ã•ã‚ŒãŸã‚Šï¼Œæ“ã‚‰ã‚ŒãŸã‚Šã—ã¦ã—ã¾ã†ã‚‚ã®ã ã€‚"
    ],
    
    // è‡ªå·±æ„›å‚¾å‘ï¼ˆNarcissismï¼‰: 9é …ç›®
    // è‡ªå·±ã®é‡è¦æ€§ã‚„å„ªè¶Šæ€§ã®éå¤§è©•ä¾¡
    N: [
      "å‘¨ã‚Šã®äººã¯ç§ã‚’ç”Ÿã¾ã‚ŒãªãŒã‚‰ã®ãƒªãƒ¼ãƒ€ãƒ¼ã ã¨æ€ã£ã¦ã„ã‚‹ã€‚",
      "ç§ã¯æ³¨ç›®ã®çš„ã«ãªã‚‹ã“ã¨ãŒå«Œã„ã ã€‚",
      "ç§ãªã—ã§ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤šãã®æ´»å‹•ãŒæ»ã£ã¦ã—ã¾ã†ã€‚",
      "å‘¨ã‚Šã®äººãŒãã†è¨€ã£ã¦ã„ã‚‹ã®ã§ç§ã¯ç‰¹åˆ¥ãªäººé–“ãªã®ã ã¨æ€ã†ã€‚",
      "ç§ã¯åœ°ä½ã®é«˜ã„é‡è¦ãªäººç‰©ã¨è¦ªã—ããªã‚‹ã®ã‚’å¥½ã‚“ã§ã„ã‚‹ã€‚",
      "ç§ã¯è¤’ã‚ã‚‰ã‚Œã‚‹ã¨æ¥ãšã‹ã—ããªã£ã¦ã—ã¾ã†ã€‚",
      "ç§ã¯ã“ã‚Œã¾ã§ã«è‘—åãªäººç‰©ã«ãŸãŸãˆã‚‰ã‚ŒãŸã“ã¨ãŒã‚ã‚‹ã€‚",
      "ç§ã¯å¹³å‡çš„ã§ãŸã„ã—ãŸã“ã¨ã®ãªã„äººé–“ã ã€‚",
      "ç§ã¯è‡ªåˆ†ãŒå—ã‘ã‚‹ã«å€¤ã™ã‚‹å°Šæ•¬ã‚’é›†ã‚ã‚‹ã¹ãäººé–“ã ã€‚"
    ],
    
    // ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘ï¼ˆPsychopathyï¼‰: 9é …ç›®
    // è¡å‹•æ€§ã‚„å…±æ„Ÿæ€§ã®æ¬ å¦‚
    P: [
      "ç§ã¯ç›®ä¸Šã®äººã«ä»•è¿”ã—ã‚„å ±å¾©ã‚’ã—ãŸã„ã¨æ€ã†ã“ã¨ãŒã‚ã‚‹ã€‚",
      "ç§ã¯ç‰©é¨’ãªçŠ¶æ³ã«é£›ã³è¾¼ã‚€ã‚ˆã†ãªã“ã¨ã¯ã—ãªã„ã€‚",
      "å ±å¾©ã¯ï¼Œå³åº§ã«ï¼Œå†·é…·ã«è¡Œã†ã‚‚ã®ã ã€‚",
      "ç§ã¯ä»–äººã‹ã‚‰ã‚ˆãæ‰‹ã«è² ãˆãªã„ã¨è¨€ã‚ã‚Œã‚‹ã€‚",
      "ç§ã¯ä»–äººã«ã¤ã‚‰ãå½“ãŸã£ã¦ã‚‚å¹³æ°—ã ã¨ã„ã†ã®ãŒå®Ÿéš›ã®ã¨ã“ã‚ã ã€‚",
      "ç§ã‚’ã‹ã‚‰ã‹ã†è€…ã¯ã„ã¤ã¾ã§ã‚‚ãã®è¡Œç‚ºã‚’å¾Œæ‚”ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚",
      "ç§ã¯äººã«è¿·æƒ‘ã‚’ã‹ã‘ã‚‹ã‚ˆã†ãªå•é¡Œã‚’èµ·ã“ã—ã¦ã„ãªã„ã€‚",
      "ç§ã¯å¾Œå…ˆè€ƒãˆãšã«ï¼Œã»ã¨ã‚“ã©çŸ¥ã‚‰ãªã„ç•°æ€§ã¨é–¢ä¿‚ã‚’æŒã¤ã®ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã‚ã‚‹ã€‚",
      "ç§ã¯èª°ã«ä½•ã‚’è¨€ã£ã¦ã‚‚ï¼Œæ¬²ã—ã„ã‚‚ã®ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã€‚"
    ]
  };
  
  // é€†è»¢é …ç›®ï¼ˆä½ã„å€¤ãŒãã®ç‰¹æ€§ã‚’ç¤ºã™é …ç›®ï¼‰
  // é …ç›®ç•ªå·: 11, 15, 17, 20, 25
  const REVERSED = new Set([11, 15, 17, 20, 25]);
  
  // è«–æ–‡ã§å ±å‘Šã•ã‚ŒãŸå¹³å‡å€¤ï¼ˆä¸‹å¸ãƒ»å°å¡©, 2017ï¼‰
  const PAPER_MEANS = { 
    M: 3.53,  // ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ ã®å¹³å‡
    N: 2.27,  // è‡ªå·±æ„›å‚¾å‘ã®å¹³å‡
    P: 2.43   // ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘ã®å¹³å‡
  };
  
  // ==========================================
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
  // ==========================================
  
  /**
   * ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–‡å­—åˆ—ã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã¨OSã‚’åˆ¤å®š
   * @returns {Object} browser, os, user_agent ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
   */
  function getSystemInfo() {
    const ua = navigator.userAgent;
    let browser = 'Unknown';
    let os = 'Unknown';
    
    // ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¤å®š
    if (ua.indexOf('Edg') > -1) browser = 'Edge';
    else if (ua.indexOf('Chrome') > -1) browser = 'Chrome';
    else if (ua.indexOf('Safari') > -1) browser = 'Safari';
    else if (ua.indexOf('Firefox') > -1) browser = 'Firefox';
    else if (ua.indexOf('Opera') > -1 || ua.indexOf('OPR') > -1) browser = 'Opera';
    
    // OSã®åˆ¤å®š
    if (ua.indexOf('Win') > -1) os = 'Windows';
    else if (ua.indexOf('Mac') > -1) os = 'macOS';
    else if (ua.indexOf('Linux') > -1) os = 'Linux';
    else if (ua.indexOf('Android') > -1) os = 'Android';
    else if (ua.indexOf('iPhone') > -1 || ua.indexOf('iPad') > -1) os = 'iOS';
    
    return { browser, os, user_agent: ua };
  }
  
  /**
   * æ—¥æœ¬æ™‚é–“ã®æ–‡å­—åˆ—ã‚’å–å¾—ã™ã‚‹é–¢æ•°
   * @param {number} timestamp - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰ã€‚çœç•¥æ™‚ã¯ç¾åœ¨æ™‚åˆ»
   * @returns {string} æ—¥æœ¬æ™‚é–“ã®æ–‡å­—åˆ—ï¼ˆä¾‹: "2025/10/22 14:30:45"ï¼‰
   */
  function getJapanTime(timestamp) {
    const date = timestamp ? new Date(timestamp) : new Date();
    return date.toLocaleString('ja-JP', { 
      timeZone: 'Asia/Tokyo',
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    }).replace(/\//g, '/').replace(',', '');
  }
  
  /**
   * é€²æ—ãƒãƒ¼ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
   * @param {number} fraction - é€²æ—ã®å‰²åˆï¼ˆ0.0ã€œ1.0ï¼‰
   */
  const updateProgressBar = (fraction) => {
    const barInner = document.querySelector('#jspsych-progressbar-inner');
    if (barInner) {
      barInner.style.width = `${Math.round(Math.max(0, Math.min(1, fraction)) * 100)}%`;
    }
  };
  
  /**
   * å›ç­”ã‹ã‚‰å„ç‰¹æ€§ã®å¾—ç‚¹ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
   * @param {Array} responses - 27é …ç›®ã®å›ç­”é…åˆ—ï¼ˆ0-indexedï¼‰
   * @returns {Object} å„ç‰¹æ€§ï¼ˆM, N, Pï¼‰ã®å¹³å‡å¾—ç‚¹
   */
  function computeScores(responses) {
    // å„é …ç›®ã®å¾—ç‚¹ã‚’æ ¼ç´ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    const scored = {};
    
    // å…¨27é …ç›®ã«ã¤ã„ã¦å‡¦ç†
    for (let i = 1; i <= 27; i++) {
      const v = responses[i - 1];
      
      // å›ç­”å€¤ã‚’1ã€œ5ã®æ•°å€¤ã«å¤‰æ›
      const num = (v === undefined || v === null) 
        ? null 
        : (typeof v === 'number' 
          ? v + 1 
          : parseInt(String(v).match(/^\d+/)[0], 10));
      
      // é€†è»¢é …ç›®ã®å ´åˆã¯åè»¢å‡¦ç†ï¼ˆ6 - å€¤ï¼‰
      scored[i] = (num === null) 
        ? null 
        : (REVERSED.has(i) ? 6 - num : num);
    }
    
    /**
     * æŒ‡å®šã•ã‚ŒãŸé …ç›®ç•ªå·ã®å¹³å‡å€¤ã‚’è¨ˆç®—
     * @param {Array} idxs - é …ç›®ç•ªå·ã®é…åˆ—
     * @returns {number|null} å¹³å‡å€¤
     */
    const meanOf = (idxs) => {
      const arr = idxs.map(i => scored[i]).filter(x => x != null);
      return arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : null;
    };
    
    // å„ç‰¹æ€§ã®å¹³å‡å¾—ç‚¹ã‚’è¨ˆç®—
    return { 
      M: meanOf([1, 2, 3, 4, 5, 6, 7, 8, 9]),          // ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ ï¼ˆé …ç›®1ã€œ9ï¼‰
      N: meanOf([10, 11, 12, 13, 14, 15, 16, 17, 18]), // è‡ªå·±æ„›å‚¾å‘ï¼ˆé …ç›®10ã€œ18ï¼‰
      P: meanOf([19, 20, 21, 22, 23, 24, 25, 26, 27])  // ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘ï¼ˆé …ç›®19ã€œ27ï¼‰
    };
  }
  
  // ==========================================
  // å®Ÿé¨“ç”»é¢ã®æ§‹æˆ
  // ==========================================
  
  // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã¨é–‹å§‹æ™‚åˆ»ã‚’å–å¾—
  const systemInfo = getSystemInfo();
  const startTimestamp = Date.now();
  const startTimeJST = getJapanTime(startTimestamp);
  
  // å…¨ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã«å…±é€šã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  jsPsych.data.addProperties({
    browser: systemInfo.browser,
    os: systemInfo.os,
    user_agent: systemInfo.user_agent,
    start_time_jst: startTimeJST,
    start_timestamp: startTimestamp
  });
  
  // ã€1ã€‘ã‚¤ãƒ³ãƒˆãƒ­ç”»é¢
  const intro = { 
    type: window.jsPsychHtmlButtonResponse, 
    stimulus: `
      <div class="card">
        <h2>SD3-J</h2>
        <h3>æ—¥æœ¬èªç‰ˆShort Dark Triad</h3>
        <h4>ã€Œæ„Ÿæƒ…ãƒ»äººæ ¼å¿ƒç†å­¦ã€å—è¬›è€…ç”¨</h4>
        <p class="note">
          ã“ã‚Œã¯ãƒ€ãƒ¼ã‚¯ãƒˆãƒ©ã‚¤ã‚¢ãƒ‰å‚¾å‘ã‚’è©•ä¾¡ã™ã‚‹ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã§ã™ã€‚<br>
          è¬›ç¾©å†…å®¹ã®ç†è§£ã‚’ä¿ƒé€²ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚<br>
          ãƒ‡ãƒ¼ã‚¿ã¯ä¿ç®¡ã•ã‚Œã¾ã™ãŒï¼Œå€‹äººãŒç‰¹å®šã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
          ã¾ãŸï¼Œå›ç­”ã®æœ‰ç„¡ãŒæˆç¸¾ã«å½±éŸ¿ã™ã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚
        </p>
        <ul class="small muted">
          å›ç­”æ™‚é–“ã®ç›®å®‰ï¼š3ã€œ5åˆ† <br>
          å‡ºå…¸<br>
          ä¸‹å¸å¿ å¤§ãƒ»å°å¡©çœŸå¸. (2017). æ—¥æœ¬èªç‰ˆShort Dark Triadï¼ˆSD3-Jï¼‰ã®ä½œæˆ. ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ç ”ç©¶, 26(1), 12â€“22. 
          https://doi.org/10.2132/personality.26.1.2
        </ul>
      </div>
    `, 
    choices: ['é–‹å§‹'] 
  };
  
  // ã€2ã€‘ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ±ï¼ˆå¹´é½¢ãƒ»æ€§åˆ¥ï¼‰ã®åé›†
  // hexaco60.html ã¨åŒã˜æ–¹æ³•ã§ jsPsychSurvey ã‚’ä½¿ç”¨
  const demographics = { 
    type: window.jsPsychSurvey,
    survey_json: {
      showQuestionNumbers: false,
      pages: [{
        name: 'demographics',
        elements: [
          {
            type: 'text',
            name: 'age',
            title: 'å¹´é½¢',
            inputType: 'number',
            min: 0,
            max: 120,
            isRequired: true
          },
          {
            type: 'dropdown',
            name: 'gender',
            title: 'æ€§åˆ¥',
            isRequired: true,
            choices: ['ç”·æ€§', 'å¥³æ€§', 'ãã®ä»–', 'æœªå›ç­”']
          }
        ]
      }],
      pageNextText: 'æ¬¡ã¸',
      pagePrevText: 'æˆ»ã‚‹',
      completeText: 'æ¬¡ã¸'
    },
    on_finish: (data) => {
      console.log('ğŸŸ¦ Demographics submitted');
      
      // å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const r = data.response || {};
      
      console.log('   age:', r.age);
      console.log('   gender:', r.gender);
      
      // ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
      jsPsych.data.addProperties({
        subject_demographics_age: r.age || '',
        subject_demographics_gender: r.gender || ''
      });
      
      console.log('âœ“ Demographics recorded:', {age: r.age, gender: r.gender});
    }
  };
  
  // ==========================================
  // ã€3ã€‘è³ªå•é …ç›®ã®æº–å‚™ã¨ãƒ©ãƒ³ãƒ€ãƒ åŒ–
  // ==========================================
  
  // å…¨27é …ç›®ã‚’é…åˆ—ã«æ ¼ç´ï¼ˆSD3.M, SD3.N, SD3.P ã‹ã‚‰é …ç›®ã‚’å–å¾—ï¼‰
  const allItems = [];
  
  // ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ é …ç›®ï¼ˆ1ã€œ9ï¼‰ã‚’è¿½åŠ 
  SD3.M.forEach((t, i) => allItems.push({
    idx: i + 1,        // é …ç›®ç•ªå·ï¼ˆ1ã€œ9ï¼‰
    domain: 'M',       // ç‰¹æ€§ã‚¿ã‚¤ãƒ—ï¼ˆMachiavellianismï¼‰
    text: t            // è³ªå•æ–‡
  }));
  
  // è‡ªå·±æ„›å‚¾å‘é …ç›®ï¼ˆ10ã€œ18ï¼‰ã‚’è¿½åŠ 
  SD3.N.forEach((t, i) => allItems.push({
    idx: 9 + i + 1,    // é …ç›®ç•ªå·ï¼ˆ10ã€œ18ï¼‰
    domain: 'N',       // ç‰¹æ€§ã‚¿ã‚¤ãƒ—ï¼ˆNarcissismï¼‰
    text: t            // è³ªå•æ–‡
  }));
  
  // ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘é …ç›®ï¼ˆ19ã€œ27ï¼‰ã‚’è¿½åŠ 
  SD3.P.forEach((t, i) => allItems.push({
    idx: 18 + i + 1,   // é …ç›®ç•ªå·ï¼ˆ19ã€œ27ï¼‰
    domain: 'P',       // ç‰¹æ€§ã‚¿ã‚¤ãƒ—ï¼ˆPsychopathyï¼‰
    text: t            // è³ªå•æ–‡
  }));
  
  /**
   * Fisherâ€“Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹é…åˆ—ã®ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚·ãƒ£ãƒƒãƒ•ãƒ«
   * å„é …ç›®ã®å‡ºç¾é †åºã‚’ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã™ã‚‹ã“ã¨ã§é †åºåŠ¹æœã‚’é˜²ã
   * @param {Array} a - ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹é…åˆ—
   * @returns {Array} ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸé…åˆ—ï¼ˆåŒã˜å‚ç…§ï¼‰
   */
  function shuffleInPlace(a) { 
    for (let i = a.length - 1; i > 0; i--) { 
      const j = Math.floor(Math.random() * (i + 1)); 
      [a[i], a[j]] = [a[j], a[i]]; // ES6ã®åˆ†å‰²ä»£å…¥ã§è¦ç´ ã‚’äº¤æ›
    } 
    return a; 
  }
  
  // å…¨27é …ç›®ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆ
  shuffleInPlace(allItems);
  
  // ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã—ãŸé …ç›®ã‚’9é …ç›®ãšã¤3ãƒšãƒ¼ã‚¸ã«åˆ†å‰²
  // å„ãƒšãƒ¼ã‚¸ã«ç´„9é …ç›®ãšã¤é…ç½®ã™ã‚‹ã“ã¨ã§å›ç­”è€…ã®è² æ‹…ã‚’è»½æ¸›
  const pages = [
    allItems.slice(0, 9),    // ãƒšãƒ¼ã‚¸1: é …ç›®1ã€œ9
    allItems.slice(9, 18),   // ãƒšãƒ¼ã‚¸2: é …ç›®10ã€œ18
    allItems.slice(18, 27)   // ãƒšãƒ¼ã‚¸3: é …ç›®19ã€œ27
  ];
  
  // ==========================================
  // ã€4ã€‘Likertå°ºåº¦ãƒšãƒ¼ã‚¸ã®ç”Ÿæˆ
  // ==========================================
  
  // å„ãƒšãƒ¼ã‚¸ã”ã¨ã«jsPsychSurveyLikertãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚’ä½œæˆ
  const likertPages = pages.map((items, k) => ({
    type: window.jsPsychSurveyLikert,
    
    // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã®èª¬æ˜æ–‡ï¼ˆç¾åœ¨ã®è³ªå•ç•ªå·ã¨ç·æ•°ã‚’è¡¨ç¤ºï¼‰
    preamble: `
      <div class="card">
        <b>è³ªå• ${k * 9 + 1}â€“${k * 9 + items.length} / 27</b>
        <p style="margin:0.5rem 0 0; font-size:0.95rem;">
          å„æ–‡ã«ã¤ã„ã¦ã€ã©ã®ç¨‹åº¦åŒæ„ã™ã‚‹ã‹ã‚’ç¤ºã—ã¦ãã ã•ã„ã€‚<br>
          é¸æŠè‚¢ï¼š<br>
          1=å…¨ããã†æ€ã‚ãªã„<br>
          2=ãã†æ€ã‚ãªã„<br>
          3=ã©ã¡ã‚‰ã‹ã¨ã‚‚ã„ãˆãªã„<br>
          4=ãã†æ€ã†<br>
          5=éå¸¸ã«ãã†æ€ã†
        </p>
      </div>
    `,
    
    // ã“ã®ãƒšãƒ¼ã‚¸ã®è³ªå•é …ç›®ã‚’ç”Ÿæˆ
    questions: items.map((it, pageIdx) => {
      // å„ç‰¹æ€§å†…ã§ã®é …ç›®ç•ªå·ï¼ˆ1ã€œ9ï¼‰
      const domainItemNum = pageIdx + 1;
      // å¤‰æ•°åï¼ˆä¾‹: M1, N5, P3ï¼‰
      const name = `${it.domain}${domainItemNum}`;
      
      return {
        prompt: it.text,                    // è³ªå•æ–‡
        labels: ['1','2','3','4','5'],      // é¸æŠè‚¢ã®æ•°å€¤ãƒ©ãƒ™ãƒ«
        name: name,                         // ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ™‚ã®å¤‰æ•°å
        required: true                      // å¿…é ˆå›ç­”
      };
    }),
    
    // ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ï¼ˆæœ€çµ‚ãƒšãƒ¼ã‚¸ã®ã¿ã€Œçµæœã‚’è¦‹ã‚‹ã€ï¼‰
    button_label: k === 2 ? 'çµæœã‚’è¦‹ã‚‹' : 'æ¬¡ã¸',
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
    on_load: () => {
      // é¸æŠè‚¢ãƒ©ãƒ™ãƒ«ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ä»˜ä¸
      const opts = [
        'å…¨ããã†æ€ã‚ãªã„',
        'ãã†æ€ã‚ãªã„',
        'ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„',
        'ãã†æ€ã†',
        'éå¸¸ã«ãã†æ€ã†'
      ];
      
      // DOMã®æ§‹ç¯‰ã‚’å¾…ã£ã¦ã‹ã‚‰ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¨­å®š
      setTimeout(() => {
        document.querySelectorAll('.jspsych-survey-likert-opt-label').forEach((label, i) => {
          // é‡è¤‡ã‚¯ãƒ©ã‚¹ä»˜ä¸ã‚’é˜²æ­¢
          if (!label.classList.contains('likert-label-tooltip')) {
            label.classList.add('likert-label-tooltip');
          }
          // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®šï¼ˆ5ã¤ã®é¸æŠè‚¢ã‚’ç¹°ã‚Šè¿”ã—ï¼‰
          label.setAttribute('data-tooltip', opts[i % 5]);
        });
      }, 100);
      
      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–°ï¼ˆç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã¾ã§ã®é€²æ—ç‡ï¼‰
      updateProgressBar((k * 9 + items.length) / 27);
    },
    
    // å›ç­”çµ‚äº†æ™‚ã®å‡¦ç†ï¼š0-4ã‚’1-5ã«å¤‰æ›ã—ã€é€†è»¢é …ç›®ã‚’è€ƒæ…®ã—ãŸå¾—ç‚¹ã‚’è¿½åŠ 
    on_finish: (data) => {
      const resp = data.response || {};
      
      // ãƒšãƒ¼ã‚¸ç•ªå·ã‚’è¨˜éŒ²ï¼ˆ1, 2, 3ï¼‰
      data.page_number = k + 1;
      
      // ã“ã®ãƒšãƒ¼ã‚¸ã§å›ç­”ã—ãŸé …ç›®ç•ªå·ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
      const pageItems = items.map(it => it.idx).join(',');
      data.page_items = pageItems;
      
      // å„å›ç­”ã«ã¤ã„ã¦å‡¦ç†
      Object.entries(resp).forEach(([name, idx]) => {
        // è©²å½“ã™ã‚‹é …ç›®ã‚’æ¤œç´¢
        const item = items.find(it => {
          const itemNum = items.indexOf(it) + 1;
          return `${it.domain}${itemNum}` === name;
        });
        
        if (item) {
          // 0-4ã‚’1-5ã«å¤‰æ›
          const rawScore = Number(idx) + 1;
          
          // é€†è»¢é …ç›®ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦å¾—ç‚¹ã‚’è¨ˆç®—
          const scoredValue = REVERSED.has(item.idx) ? (6 - rawScore) : rawScore;
          
          // å…ƒã®å¤‰æ•°åã«å¯¾å¿œã™ã‚‹å¾—ç‚¹å¤‰æ•°ã‚’è¿½åŠ 
          // ä¾‹: M1 â†’ M1_raw (1-5ã®ç”Ÿå¾—ç‚¹), M1_scored (é€†è»¢å‡¦ç†æ¸ˆã¿å¾—ç‚¹)
          data[`${name}_raw`] = rawScore;
          data[`${name}_scored`] = scoredValue;
          
          // é …ç›®ç•ªå·ã‚‚è¨˜éŒ²
          data[`${name}_item_number`] = item.idx;
        }
      });
    }
  }));
  
  // ==========================================
  // ã€5ã€‘ãƒ‡ãƒ¼ã‚¿ä¿å­˜è¨­å®š
  // ==========================================
  
  // ãƒ©ãƒ³ãƒ€ãƒ ãªè¢«é¨“è€…IDã‚’ç”Ÿæˆï¼ˆ10æ¡ã®è‹±æ•°å­—ï¼‰
  const subject_id = jsPsych.randomization.randomID(10);
  
  // DataPipeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦OSFã«CSVãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
  const save_data = { 
    type: window.jsPsychPipe,           // DataPipeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨
    action: 'save',                     // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    experiment_id: 'GyvSHLaKTiph',      // å®Ÿé¨“IDï¼ˆOSFä¸Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè­˜åˆ¥å­ï¼‰
    filename: `${subject_id}.csv`,      // ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆè¢«é¨“è€…IDã‚’ä½¿ç”¨ï¼‰
    data_string: () => jsPsych.data.get().csv()  // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§å–å¾—
  };
  
  // ==========================================
  // ã€6ã€‘çµæœè¡¨ç¤ºç”»é¢
  // ==========================================
  
  const results = {
    type: window.jsPsychHtmlButtonResponse,
    
    // çµæœç”»é¢ã®HTMLç”Ÿæˆï¼ˆstimulusé–¢æ•°ï¼‰
    stimulus: () => {
      // survey-likertãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const trials = jsPsych.data.get().filter({trial_type:'survey-likert'}).values();
      
      // 27é …ç›®åˆ†ã®å›ç­”ã‚’æ ¼ç´ã™ã‚‹é…åˆ—ï¼ˆåˆæœŸå€¤ã¯nullï¼‰
      const responses = new Array(27).fill(null);
      
      // å„ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‹ã‚‰å›ç­”ã‚’æŠ½å‡ºã—ã¦é…åˆ—ã«æ ¼ç´
      trials.forEach(tr => {
        const resp = tr.response || {};
        Object.entries(resp).forEach(([name, idx]) => {
          // å¤‰æ•°åã‹ã‚‰é …ç›®æƒ…å ±ã‚’æŠ½å‡ºï¼ˆä¾‹: "M1" â†’ ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ 1ç•ªç›®ï¼‰
          // allItemsé…åˆ—ã‹ã‚‰è©²å½“ã™ã‚‹é …ç›®ã‚’æ¢ã—ã¦é …ç›®ç•ªå·ã‚’å–å¾—
          const item = allItems.find(it => `${it.domain}${allItems.filter(x => x.domain === it.domain).indexOf(it) + 1}` === name);
          if (item) {
            // é …ç›®ç•ªå·ï¼ˆ1ã€œ27ï¼‰ã‚’ä½¿ã£ã¦é…åˆ—ã«æ ¼ç´ï¼ˆ0-indexedã«å¤‰æ›ï¼‰
            responses[item.idx - 1] = Number(idx) + 1;  // é¸æŠè‚¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(0-4)ã‚’å¾—ç‚¹(1-5)ã«å¤‰æ›
          }
        });
      });
      
      // å„ç‰¹æ€§ã®å¾—ç‚¹ã‚’è¨ˆç®—
      const s = computeScores(responses);
      
      // æ•°å€¤ã‚’å°æ•°ç‚¹2æ¡ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆnullã®å ´åˆã¯"-"ï¼‰
      const fmt = v => (v == null ? '-' : v.toFixed(2));
      
      // çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡ŒHTMLç”Ÿæˆ
      const rowsHtml = `
        <tr><td>ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ  (M)</td><td>${fmt(s.M)}</td><td>${fmt(PAPER_MEANS.M)}</td></tr>
        <tr><td>è‡ªå·±æ„›å‚¾å‘ (N)</td><td>${fmt(s.N)}</td><td>${fmt(PAPER_MEANS.N)}</td></tr>
        <tr><td>ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘ (P)</td><td>${fmt(s.P)}</td><td>${fmt(PAPER_MEANS.P)}</td></tr>
      `;
      
      // çµæœç”»é¢å…¨ä½“ã®HTML
      return `
        <div class="card">
          <h2>çµæœ</h2>
          <div class="chart-wrap">
            <canvas id="sd3-radar"></canvas>
          </div>
          <div class="small muted" style="margin-top:0.5rem; font-size:0.8rem;">
            æ³¨ï¼šä¸‹å¸å¿ å¤§ãƒ»å°å¡©çœŸå¸. (2017). æ—¥æœ¬èªç‰ˆShort Dark Triadï¼ˆSD3-Jï¼‰ã®ä½œæˆ. ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ç ”ç©¶, 26(1), 12â€“22. 
            https://doi.org/10.2132/personality.26.1.2
          </div>
          <table>
            <thead>
              <tr><th>ç‰¹æ€§</th><th>ã‚ãªãŸ</th><th>è«–æ–‡ã®å¹³å‡</th></tr>
            </thead>
            <tbody>${rowsHtml}</tbody>
          </table>
        </div>
      `;
    },
    
    choices: ['çµ‚äº†'],
    
    // ã€Œçµ‚äº†ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®å‡¦ç†
    on_finish: () => {
      // çµ‚äº†æ™‚åˆ»ã¨æ‰€è¦æ™‚é–“ã‚’è¨˜éŒ²
      const endTimestamp = Date.now();
      const endTimeJST = getJapanTime(endTimestamp);
      const durationMs = endTimestamp - startTimestamp;
      const durationSec = durationMs / 1000;
      const durationMin = durationSec / 60;
      
      // å…¨ãƒ‡ãƒ¼ã‚¿ã«çµ‚äº†æ™‚åˆ»ã¨æ‰€è¦æ™‚é–“ã‚’è¿½åŠ 
      jsPsych.data.addProperties({
        end_time_jst: endTimeJST,
        end_timestamp: endTimestamp,
        total_duration_ms: durationMs,
        total_duration_sec: parseFloat(durationSec.toFixed(2)),
        total_duration_min: parseFloat(durationMin.toFixed(2))
      });
      
      // ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      window.location.href = 'https://mshrymgc.github.io/epp_scales/';
    },
    
    // çµæœç”»é¢èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
    on_load: () => {
      // survey-likertãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
      const trials = jsPsych.data.get().filter({trial_type:'survey-likert'}).values();
      
      // 27é …ç›®åˆ†ã®å›ç­”ã‚’æ ¼ç´ã™ã‚‹é…åˆ—ï¼ˆåˆæœŸå€¤ã¯nullï¼‰
      const responses = new Array(27).fill(null);
      
      // å„ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‹ã‚‰å›ç­”ã‚’æŠ½å‡º
      trials.forEach(tr => {
        const resp = tr.response || {};
        Object.entries(resp).forEach(([name, idx]) => {
          // å¤‰æ•°åã‹ã‚‰é …ç›®æƒ…å ±ã‚’æŠ½å‡ºï¼ˆä¾‹: "M1" â†’ ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ 1ç•ªç›®ï¼‰
          const item = allItems.find(it => `${it.domain}${allItems.filter(x => x.domain === it.domain).indexOf(it) + 1}` === name);
          if (item) {
            responses[item.idx - 1] = Number(idx) + 1;
          }
        });
      });
      
      // å„ç‰¹æ€§ã®å¾—ç‚¹ã‚’è¨ˆç®—
      const s = computeScores(responses);
      
      // ==========================================
      // Chart.jsã§ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
      // ==========================================
      
      // ãƒãƒ£ãƒ¼ãƒˆã®è‰²è¨­å®š
      const palette = {
        selfBorder: '#1976D2',             // ãƒ¦ãƒ¼ã‚¶ãƒ¼å¾—ç‚¹ã®ç·šè‰²ï¼ˆé’ï¼‰
        selfFill: 'rgba(25,118,210,0.15)', // ãƒ¦ãƒ¼ã‚¶ãƒ¼å¾—ç‚¹ã®å¡—ã‚Šè‰²ï¼ˆåŠé€æ˜ã®é’ï¼‰
        normBorder: '#D32F2F',             // è«–æ–‡å¹³å‡ã®ç·šè‰²ï¼ˆèµ¤ï¼‰
        normFill: 'rgba(211,47,47,0.15)'   // è«–æ–‡å¹³å‡ã®å¡—ã‚Šè‰²ï¼ˆåŠé€æ˜ã®èµ¤ï¼‰
      };
      
      // Canvasè¦ç´ ã®ã‚µã‚¤ã‚ºã‚’è¦ªè¦ç´ ã«åˆã‚ã›ã¦èª¿æ•´
      const canvas = document.getElementById('sd3-radar');
      if (canvas) {
        const wrap = canvas.parentElement;
        canvas.width = wrap.offsetWidth;
        canvas.height = wrap.offsetHeight;
      }
      
      // Chart.jsã§ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆ
      new Chart(document.getElementById('sd3-radar').getContext('2d'), {
        type: 'radar',  // ãƒãƒ£ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ï¼šãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
        data: {
          // å„è»¸ã®ãƒ©ãƒ™ãƒ«ï¼ˆ3ã¤ã®ç‰¹æ€§ï¼‰
          labels: ['ãƒã‚­ãƒ£ãƒ™ãƒªã‚¢ãƒ‹ã‚ºãƒ ', 'è‡ªå·±æ„›å‚¾å‘', 'ã‚µã‚¤ã‚³ãƒ‘ã‚·ãƒ¼å‚¾å‘'],
          
          // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¾—ç‚¹ã¨è«–æ–‡å¹³å‡ï¼‰
          datasets: [
            {
              label: 'ã‚ãªãŸ', 
              data: [s.M, s.N, s.P],              // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å„ç‰¹æ€§å¾—ç‚¹
              fill: true,                         // å¡—ã‚Šã¤ã¶ã—æœ‰åŠ¹
              borderColor: palette.selfBorder,    // ç·šã®è‰²
              backgroundColor: palette.selfFill,  // å¡—ã‚Šã¤ã¶ã—ã®è‰²
              borderWidth: 2.2,                   // ç·šã®å¤ªã•
              tension: 0,                         // ç›´ç·šã§çµã¶ï¼ˆæ›²ç·šãªã—ï¼‰
              pointRadius: 2                      // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®åŠå¾„
            },
            {
              label: 'è«–æ–‡ã®å¹³å‡', 
              data: [PAPER_MEANS.M, PAPER_MEANS.N, PAPER_MEANS.P], // è«–æ–‡ã®å¹³å‡å¾—ç‚¹
              fill: true, 
              borderColor: palette.normBorder, 
              backgroundColor: palette.normFill, 
              borderWidth: 2.2, 
              tension: 0, 
              pointRadius: 2
            }
          ]
        },
        options: { 
          responsive: false,           // è‡ªå‹•ãƒªã‚µã‚¤ã‚ºç„¡åŠ¹
          maintainAspectRatio: false,  // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šç„¡åŠ¹
          scales: { 
            r: {                       // ãƒ¬ãƒ¼ãƒ€ãƒ¼è»¸ã®è¨­å®š
              min: 1,                  // æœ€å°å€¤ï¼ˆ1ç‚¹ï¼‰
              max: 5,                  // æœ€å¤§å€¤ï¼ˆ5ç‚¹ï¼‰
              ticks: {stepSize: 1}     // ç›®ç››ã‚Šã®é–“éš”ï¼ˆ1ç‚¹åˆ»ã¿ï¼‰
            }
          }, 
          plugins: {
            legend: {position: 'bottom'} // å‡¡ä¾‹ã‚’ä¸‹éƒ¨ã«é…ç½®
          }, 
          elements: {
            line: {tension: 0}         // å…¨ã¦ã®ç·šã‚’ç›´ç·šåŒ–
          }
        }
      });
    }
  };
  
  // ==========================================
  // ã€7ã€‘å®Ÿé¨“ã®å®Ÿè¡Œ
  // ==========================================
  
  // ãƒ‡ãƒãƒƒã‚°: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’ãƒ­ã‚°
  console.log('ğŸŸ¦ Timeline before jsPsych.run:');
  console.log('  intro:', intro);
  console.log('  demographics:', demographics);
  console.log('  likertPages.length:', likertPages.length);
  console.log('  save_data:', save_data);
  console.log('  results:', results);
  
  // jsPsychã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’é †ç•ªã«å®Ÿè¡Œ
  // 1. ã‚¤ãƒ³ãƒˆãƒ­ç”»é¢ â†’ 2. ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ± â†’ 3. Likertå°ºåº¦3ãƒšãƒ¼ã‚¸ â†’ 4. ãƒ‡ãƒ¼ã‚¿ä¿å­˜ â†’ 5. çµæœè¡¨ç¤º
     const timeline = [intro, demographics, ...likertPages, save_data, results];
  console.log('ğŸŸ¦ Timeline array length:', timeline.length);
  console.log('ğŸŸ¦ Timeline[0] (intro):', timeline[0]);
  console.log('ğŸŸ¦ Timeline[1] (demographics):', timeline[1]);
  
  jsPsych.run(timeline);
})();
  </script>
</body>
</html>
