<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ã‚¢ã‚¤ã‚ªãƒ¯ã‚®ãƒ£ãƒ³ãƒ–ãƒªãƒ³ã‚°èª²é¡Œ</title>
  <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" />
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f5f7 0%, #ffffff 100%);
    }

    .jspsych-content {
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    h1 {
      color: #1d1d1f;
      font-size: 1.8rem;
      margin: 0 0 1rem 0;
      font-weight: 700;
      text-align: center;
    }

    h2 {
      color: #0071e3;
      font-size: 1.3rem;
      margin-top: 1.5rem;
      margin-bottom: 0.8rem;
      font-weight: 600;
    }

    .jspsych-btn {
      background-color: #0071e3;
      color: #fff;
      border: 1px solid #0071e3;
      padding: 0.6rem 1.2rem;
      margin: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .jspsych-btn:hover {
      background-color: #0059b3;
      border-color: #0059b3;
    }

    .status-bar {
      display: flex;
      justify-content: space-around;
      margin: 1rem 0;
      padding: 1rem;
      background: #f5f5f7;
      border-radius: 8px;
    }

    .status-item {
      text-align: center;
    }

    .status-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.3rem;
    }

    .status-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1d1d1f;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .result-item {
      background: #f5f5f7;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
    }

    .result-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 0.5rem;
    }

    .result-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1d1d1f;
    }

    .result-value.positive {
      color: #34c759;
    }

    .result-value.negative {
      color: #ff3b30;
    }
  </style>
  <script src="https://unpkg.com/jspsych@7.3.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.5.0/dist/index.browser.min.js"></script>
</head>
<body>
  <div id="jspsych-target"></div>
  <script>
(() => {
  // =====================================
  // å®šæ•°ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
  // =====================================
  const TRIALS_PER_BLOCK = 16;
  const NUM_BLOCKS = 4;
  const TOTAL_TRIALS = TRIALS_PER_BLOCK * NUM_BLOCKS;
  const INITIAL_MONEY = 2000;

  // ãƒ‡ãƒƒã‚­å®šç¾©
  const baseDeckDefinitions = {
    A: {
      gains: [75, 100, 125],
      losses: [200, 250, 250, 300]
    },
    B: {
      gains: [75, 100, 125],
      losses: [1000, 1250, 1250, 1500]
    },
    C: {
      gains: [25, 50, 75],
      losses: [25, 50, 50, 75, 0, 0, 0, 0, 0, 0, 0, 0]
    },
    D: {
      gains: [25, 50, 75],
      losses: [150, 200, 200, 250, 0, 0, 0, 0, 0, 0, 0, 0]
    }
  };

  // =====================================
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
  // =====================================
  function detectSystemInfo() {
    const ua = navigator.userAgent;
    let browser = 'Unknown';
    let os = 'Unknown';

    if (ua.indexOf('Firefox') > -1) {
      browser = 'Firefox';
    } else if (ua.indexOf('Opera') > -1 || ua.indexOf('OPR') > -1) {
      browser = 'Opera';
    } else if (ua.indexOf('Trident') > -1) {
      browser = 'Internet Explorer';
    } else if (ua.indexOf('Edge') > -1 || ua.indexOf('Edg') > -1) {
      browser = 'Edge';
    } else if (ua.indexOf('Chrome') > -1) {
      browser = 'Chrome';
    } else if (ua.indexOf('Safari') > -1) {
      browser = 'Safari';
    }

    if (ua.indexOf('Win') > -1) {
      os = 'Windows';
    } else if (ua.indexOf('Mac') > -1) {
      os = 'macOS';
    } else if (ua.indexOf('Linux') > -1) {
      os = 'Linux';
    } else if (ua.indexOf('Android') > -1) {
      os = 'Android';
    } else if (ua.indexOf('iOS') > -1 || ua.indexOf('iPhone') > -1 || ua.indexOf('iPad') > -1) {
      os = 'iOS';
    }

    return { browser, os, userAgent: ua };
  }

  function generateBlockDecks() {
    const blockDecks = [];
    
    for (let i = 0; i < NUM_BLOCKS; i++) {
      // æ¨™æº–çš„ãªIGT: å„ãƒ–ãƒ­ãƒƒã‚¯ã§åŒã˜ãƒ‡ãƒƒã‚­å®šç¾©ã‚’ä½¿ç”¨
      // A/B/C/Dã®ä½ç½®ã¨ç‰¹æ€§ã¯å¸¸ã«å›ºå®š
      const decks = {};
      Object.keys(baseDeckDefinitions).forEach(key => {
        decks[key] = JSON.parse(JSON.stringify(baseDeckDefinitions[key]));
      });
      blockDecks.push(decks);
    }
    
    return blockDecks;
  }

  // =====================================
  // jsPsychåˆæœŸåŒ–
  // =====================================
  const jsPsych = window.jsPsychModule.initJsPsych({
    display_element: 'jspsych-target'
  });

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¨­å®š
  const subjectId = jsPsych.randomization.randomID(10);
  const filename = `${subjectId}.csv`;
  const sessionStart = Date.now();
  const systemInfo = detectSystemInfo();

  jsPsych.data.addProperties({
    subject_id: subjectId,
    timestamp_start: new Date().toISOString(),
    start_timestamp: sessionStart,
    browser: systemInfo.browser,
    os: systemInfo.os,
    user_agent: systemInfo.userAgent,
    task_name: 'IGT',
    total_trials: TOTAL_TRIALS,
    trials_per_block: TRIALS_PER_BLOCK,
    num_blocks: NUM_BLOCKS,
    initial_money: INITIAL_MONEY
  });

  // =====================================
  // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰
  // =====================================
  const timeline = [];

  // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒšãƒ¼ã‚¸
  timeline.push({
    type: window.jsPsychHtmlButtonResponse,
    stimulus: `
      <div class="card" style="max-width: 800px;">
        <h1>ğŸ° ã‚¢ã‚¤ã‚ªãƒ¯ã‚®ãƒ£ãƒ³ãƒ–ãƒªãƒ³ã‚°èª²é¡Œ</h1>
        <p style="text-align: center; color: #666; margin: 1rem 0;">
          ã“ã®èª²é¡Œã¯ã‚¢ã‚¤ã‚ªãƒ¯ã‚®ãƒ£ãƒ³ãƒ–ãƒªãƒ³ã‚°èª²é¡Œã‚’ä½“é¨“ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿé¨“ã§ã‚ã‚Šï¼Œè¬›ç¾©å†…å®¹ã®ç†è§£ã‚’ä¿ƒé€²ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚<br>ã“ã®çµæœã ã‘ã§åŒ»å­¦çš„è¨ºæ–­ã‚’è¡Œã£ãŸã‚Šï¼Œã‚ãªãŸã®è¡Œå‹•å‚¾å‘ã‚’æ­£ç¢ºã«æ¸¬å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚<br>ãƒ‡ãƒ¼ã‚¿ã¯ä¿ç®¡ã•ã‚Œã¾ã™ãŒï¼Œå€‹äººãŒç‰¹å®šã•ã‚Œã‚‹ã“ã¨ã¯ãªãï¼Œå›ç­”ã®æœ‰ç„¡ãŒæˆç¸¾ã«å½±éŸ¿ã™ã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚<br>

          ã“ã®èª²é¡Œã§ã¯ã€<strong>4ã¤ã®æœ­ã®å±±ã‹ã‚‰ç¹°ã‚Šè¿”ã—é¸æŠã‚’è¡Œã„ã€åˆ©ç›Šã‚’æœ€å¤§åŒ–ã™ã‚‹</strong>ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<br>
          4ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå„16è©¦è¡Œã€åˆè¨ˆ64è©¦è¡Œï¼‰ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚
        </p>
        <div style="background: #f5f5f7; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
          <p><strong>ã‚²ãƒ¼ãƒ ã®èª¬æ˜</strong></p>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem; text-align: left;">
            <li>å„è©¦è¡Œã§4ã¤ã®æœ­ã®å±±ï¼ˆA, B, C, Dï¼‰ã‹ã‚‰1ã¤é¸ã³ã¾ã™</li>
            <li>ç²å¾—é¡ã¨æå¤±é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
            <li>æœ€å¾Œã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
          </ul>
        </div>
      </div>
    `,
    choices: ['é–‹å§‹']
  });

  // å¹´é½¢ãƒ»æ€§åˆ¥å…¥åŠ›
  timeline.push({
    type: window.jsPsychHtmlButtonResponse,
    stimulus: `
      <div class="card" style="max-width: 600px;">
        <h2 style="text-align: center;">å‚åŠ è€…æƒ…å ±ã®å…¥åŠ›</h2>
        <div style="margin: 2rem 0;">
          <div style="margin: 1rem 0;">
            <label for="age_input" style="display: block; margin-bottom: 0.5rem;">å¹´é½¢: <span style="color: red;">*</span></label>
            <input type="number" id="age_input" min="1" max="150" style="width: 100%; padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px;" />
          </div>
          <div style="margin: 1rem 0;">
            <label for="gender_input" style="display: block; margin-bottom: 0.5rem;">æ€§åˆ¥: <span style="color: red;">*</span></label>
            <select id="gender_input" style="width: 100%; padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px;">
              <option value="">-- é¸æŠ --</option>
              <option value="ç”·æ€§">ç”·æ€§</option>
              <option value="å¥³æ€§">å¥³æ€§</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
              <option value="æœªå›ç­”">æœªå›ç­”</option>
            </select>
          </div>
          <div id="error_message" style="color: red; margin-top: 1rem; text-align: center; display: none; font-weight: bold;">
            å¹´é½¢ã¨æ€§åˆ¥ã¯å¿…é ˆã§ã™ã€‚
          </div>
        </div>
      </div>
    `,
    choices: ['æ¬¡ã¸é€²ã‚€'],
    on_load: () => {
      const button = document.querySelector('.jspsych-btn');
      button.addEventListener('click', (e) => {
        const age = document.getElementById('age_input')?.value;
        const gender = document.getElementById('gender_input')?.value;
        
        if (!age || !gender || age === '' || gender === '') {
          e.preventDefault();
          e.stopPropagation();
          document.getElementById('error_message').style.display = 'block';
          return false;
        }
      });
    },
    on_finish: (data) => {
      const age = document.getElementById('age_input')?.value || '';
      const gender = document.getElementById('gender_input')?.value || '';
      data.age = age;
      data.gender = gender;
      jsPsych.data.addProperties({
        age: age,
        gender: gender
      });
    }
  });

  // ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ§‹ç¯‰
  const blockDecks = generateBlockDecks();
  let allDeckChoices = { A: 0, B: 0, C: 0, D: 0 };
  let allGains = [];
  let allLosses = [];

  for (let blockNum = 0; blockNum < NUM_BLOCKS; blockNum++) {
    const currentBlockDecks = blockDecks[blockNum];
    let blockGains = [];
    let blockLosses = [];
    let blockDeckChoices = { A: 0, B: 0, C: 0, D: 0 };

    // ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    timeline.push({
      type: window.jsPsychHtmlButtonResponse,
      stimulus: `
        <div class="card">
          <h1>ãƒ–ãƒ­ãƒƒã‚¯ ${blockNum + 1}/${NUM_BLOCKS}</h1>
          <p style="text-align: center; color: #666;">ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã§ã¯16å›ã®é¸æŠã‚’è¡Œã„ã¾ã™ã€‚</p>
        </div>
      `,
      choices: ['é–‹å§‹']
    });

    // 16è©¦è¡Œã®ãƒ«ãƒ¼ãƒ—
    for (let trialNum = 0; trialNum < TRIALS_PER_BLOCK; trialNum++) {
      // ãƒ‡ãƒƒã‚­é¸æŠ
      timeline.push({
        type: window.jsPsychHtmlButtonResponse,
        stimulus: function() {
          const currentMoney = INITIAL_MONEY + allGains.reduce((a, b) => a + b, 0) - allLosses.reduce((a, b) => a + b, 0);
          return `
            <div class="card">
              <h2>ãƒ–ãƒ­ãƒƒã‚¯ ${blockNum + 1}/4 - è©¦è¡Œ ${trialNum + 1}/16</h2>
              <p style="text-align: center; margin: 1rem 0;">4ã¤ã®æœ­ã®å±±ã‹ã‚‰1ã¤é¸ã‚“ã§ãã ã•ã„</p>
              <div class="status-bar">
                <div class="status-item">
                  <div class="status-label">ç¾åœ¨ã®è³‡é‡‘</div>
                  <div class="status-value">${currentMoney}</div>
                </div>
                <div class="status-item">
                  <div class="status-label">é€²æ—</div>
                  <div class="status-value">${trialNum + 1}/${TRIALS_PER_BLOCK}</div>
                </div>
              </div>
            </div>
          `;
        },
        choices: ['A â™ ï¸', 'B â™¥ï¸', 'C â™¦ï¸', 'D â™£ï¸'],
        on_load: () => {
          // ãƒœã‚¿ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
          const buttons = document.querySelectorAll('.jspsych-btn');
          const icons = ['â™ ï¸', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸'];
          const labels = ['A', 'B', 'C', 'D'];
          
          buttons.forEach((btn, idx) => {
            btn.innerHTML = `
              <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.8rem; font-weight: 700;">${labels[idx]}</span>
                <span style="font-size: 3rem; line-height: 1;">${icons[idx]}</span>
              </div>
            `;
            btn.style.cssText = `
              width: 140px;
              height: 180px;
              padding: 1.5rem;
              background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
              border: 3px solid #0071e3;
              border-radius: 12px;
              cursor: pointer;
              font-size: 1rem;
              font-weight: 700;
              color: #0071e3;
              transition: all 0.2s ease;
              box-shadow: 0 4px 12px rgba(0, 113, 227, 0.15);
              display: flex;
              align-items: center;
              justify-content: center;
              margin: 1rem;
            `;
            
            btn.addEventListener('mouseover', function() {
              this.style.background = 'linear-gradient(135deg, #e3f2fd 0%, #d1e7ff 100%)';
              this.style.transform = 'translateY(-4px)';
              this.style.boxShadow = '0 8px 20px rgba(0, 113, 227, 0.25)';
            });
            
            btn.addEventListener('mouseout', function() {
              this.style.background = 'linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%)';
              this.style.transform = 'translateY(0)';
              this.style.boxShadow = '0 4px 12px rgba(0, 113, 227, 0.15)';
            });
          });
        },
        on_finish: (data) => {
          const choices = ['A', 'B', 'C', 'D'];
          const choice = choices[data.response];
          const deck = currentBlockDecks[choice];
          const gain = deck.gains[Math.floor(Math.random() * deck.gains.length)];
          const loss = deck.losses[Math.floor(Math.random() * deck.losses.length)];
          const net = gain - loss;

          blockGains.push(gain);
          blockLosses.push(loss);
          blockDeckChoices[choice]++;
          allGains.push(gain);
          allLosses.push(loss);
          allDeckChoices[choice]++;

          data.gain = gain;
          data.loss = loss;
          data.net = net;
          data.choice = choice;
        }
      });

      // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
      timeline.push({
        type: window.jsPsychHtmlButtonResponse,
        stimulus: function() {
          const lastData = jsPsych.data.get().last(1).values()[0];
          const gain = lastData.gain;
          const loss = lastData.loss;
          const net = lastData.net;
          const currentMoney = INITIAL_MONEY + allGains.reduce((a, b) => a + b, 0) - allLosses.reduce((a, b) => a + b, 0);

          let icon = 'ğŸ’«';
          let message = 'ç›¸æ®º';
          if (net > 0) {
            icon = 'âœ¨';
            message = 'åˆ©ç›Šï¼';
          } else if (net < 0) {
            icon = 'ğŸ’¥';
            message = 'æå¤±';
          }

          return `
            <div class="card" style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">${icon}</div>
              <h2>${message}</h2>
              <p style="margin: 1rem 0;">ç²å¾—: <strong>+${gain}</strong></p>
              <p style="margin: 1rem 0;">æå¤±: <strong>âˆ’${loss}</strong></p>
              <p style="font-size: 1.2rem; font-weight: 700; margin-top: 1.5rem;">
                ${net >= 0 ? '+' : 'âˆ’'}${Math.abs(net)}
              </p>
              <p style="margin-top: 1rem; color: #666;">ç¾åœ¨ã®è³‡é‡‘: ${currentMoney}</p>
            </div>
          `;
        },
        choices: ['æ¬¡ã¸']
      });
    }

    // ãƒ–ãƒ­ãƒƒã‚¯çµ‚äº†
    timeline.push({
      type: window.jsPsychHtmlButtonResponse,
      stimulus: function() {
        const blockTotal = blockGains.reduce((a, b) => a + b, 0) - blockLosses.reduce((a, b) => a + b, 0);
        const advantageous = (blockDeckChoices.C + blockDeckChoices.D) / TRIALS_PER_BLOCK * 100;
        const currentMoney = INITIAL_MONEY + allGains.reduce((a, b) => a + b, 0) - allLosses.reduce((a, b) => a + b, 0);

        return `
          <div class="card">
            <h1>ãƒ–ãƒ­ãƒƒã‚¯ ${blockNum + 1} å®Œäº†</h1>
            <div class="result-grid">
              <div class="result-item">
                <div class="result-label">ãƒ–ãƒ­ãƒƒã‚¯åæ”¯</div>
                <div class="result-value ${blockTotal >= 0 ? 'positive' : 'negative'}">
                  ${blockTotal >= 0 ? '+' : 'âˆ’'}${Math.abs(blockTotal)}
                </div>
              </div>
              <div class="result-item">
                <div class="result-label">æœ‰åˆ©ãªé¸æŠç‡</div>
                <div class="result-value">${advantageous.toFixed(1)}%</div>
              </div>
              <div class="result-item">
                <div class="result-label">ç´¯è¨ˆè³‡é‡‘</div>
                <div class="result-value">${currentMoney}</div>
              </div>
            </div>
          </div>
        `;
      },
      choices: [blockNum === NUM_BLOCKS - 1 ? 'æœ€çµ‚çµæœã¸' : 'æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯ã¸']
    });
  }

  // =====================================
  // ãƒ‡ãƒ¼ã‚¿ä¿å­˜è©¦è¡Œï¼ˆDatapipeçµŒç”±ï¼‰- æœ€çµ‚çµæœè¡¨ç¤ºã®å‰ã«å®Ÿè¡Œ
  // =====================================
  timeline.push({
    type: window.jsPsychPipe,
    action: 'save',
    experiment_id: 'RVTyUciz2P4q',
    filename: () => {
      try {
        const allData = jsPsych.data.get().values();
        const subjectId = allData.length > 0 ? allData[0].subject_id : 'unknown_subject';
        console.log('=== Pipe trial: filename:', subjectId);
        return `${subjectId}.csv`;
      } catch (e) {
        console.error('Filename error:', e);
        return 'unknown_subject.csv';
      }
    },
    data_string: () => {
      try {
        const csvData = jsPsych.data.get().csv();
        console.log('=== Pipe trial: CSV size:', csvData.length, 'bytes');
        return csvData;
      } catch (e) {
        console.error('CSV error:', e);
        return '';
      }
    },
    on_finish: () => {
      console.log('=== Pipe trial on_finish: Data saved successfully ===');
    }
  });

  // æœ€çµ‚çµæœè¡¨ç¤º
  timeline.push({
    type: window.jsPsychHtmlButtonResponse,
    stimulus: function() {
      const totalGains = allGains.reduce((a, b) => a + b, 0);
      const totalLosses = allLosses.reduce((a, b) => a + b, 0);
      const finalMoney = INITIAL_MONEY + totalGains - totalLosses;
      const advantageousChoices = (allDeckChoices.C + allDeckChoices.D) / TOTAL_TRIALS * 100;

      return `
        <div class="card">
          <h1>èª²é¡Œå®Œäº†</h1>
          <p style="text-align: center; color: #666; margin: 1rem 0;">ã™ã¹ã¦ã®è©¦è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">æœ€çµ‚è³‡é‡‘</div>
              <div class="result-value ${finalMoney >= INITIAL_MONEY ? 'positive' : 'negative'}">
                ${finalMoney}
              </div>
            </div>
            <div class="result-item">
              <div class="result-label">ç·åæ”¯</div>
              <div class="result-value ${finalMoney >= INITIAL_MONEY ? 'positive' : 'negative'}">
                ${finalMoney >= INITIAL_MONEY ? '+' : 'âˆ’'}${Math.abs(finalMoney - INITIAL_MONEY)}
              </div>
            </div>
            <div class="result-item">
              <div class="result-label">ç·åˆ©ç›Š</div>
              <div class="result-value positive">+${totalGains}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ç·æå¤±</div>
              <div class="result-value negative">âˆ’${totalLosses}</div>
            </div>
            <div class="result-item">
              <div class="result-label">æœ‰åˆ©ãªé¸æŠç‡</div>
              <div class="result-value">${advantageousChoices.toFixed(1)}%</div>
            </div>
            <div class="result-item">
              <div class="result-label">Aé¸æŠ</div>
              <div class="result-value">${allDeckChoices.A}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Bé¸æŠ</div>
              <div class="result-value">${allDeckChoices.B}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Cé¸æŠ</div>
              <div class="result-value">${allDeckChoices.C}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Dé¸æŠ</div>
              <div class="result-value">${allDeckChoices.D}</div>
            </div>
          </div>
        </div>
      `;
    },
    choices: ['çµ‚äº†'],
    on_finish: (data) => {
      console.log('=== Final results screen completed ===');
      // Redirect after user confirms results
      setTimeout(() => {
        console.log('=== Redirecting ===');
        window.location.href = 'https://mshrymgc.github.io/epp_scales/';
      }, 500);
    }
  });

  // =====================================
  // å®Ÿè¡Œ
  // =====================================
  jsPsych.run(timeline);
})();
  </script>
</body>
</html>
